(function(k){function r(){}function n(a){switch({}.toString.call(a)){case "[object File]":case "[object Blob]":case "[object FormData]":return!0;default:return!1}}function m(a){if(a!==Object(a))return a;var b=[],c;for(c in a)null!=a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function p(a){var b={};a=a.split("&");for(var c,f=0,h=a.length;f<h;++f)c=a[f],c=c.split("="),b[decodeURIComponent(c[0])]=decodeURIComponent(c[1]);return b}function s(a){return t(a.split(/ *; */),
function(a,c){var f=c.split(/ *= */),h=f.shift(),f=f.shift();h&&f&&(a[h]=f);return a},{})}function g(a,b){this.req=a;this.xhr=this.req.xhr;this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||"undefined"===typeof this.xhr.responseType?this.xhr.responseText:null;this.statusText=this.req.xhr.statusText;this.setStatusProperties(this.xhr.status);var c=this.xhr.getAllResponseHeaders().split(/\r?\n/),f={},h,e,d;c.pop();for(var g=0,u=c.length;g<u;++g)e=c[g],h=
e.indexOf(":"),d=e.slice(0,h).toLowerCase(),h=v(e.slice(h+1)),f[d]=h;this.header=this.headers=f;this.header["content-type"]=this.xhr.getResponseHeader("content-type");this.setHeaderProperties(this.header);this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function d(a,b){var c=this;q.call(this);this._query=this._query||[];this.method=a;this.url=b;this.header={};this._header={};this.on("end",function(){var a=null,b=null;try{b=new g(c)}catch(e){return a=Error("Parser is unable to parse the response"),
a.parse=!0,a.original=e,c.callback(a)}c.emit("response",b);if(a||200<=b.status&&300>b.status)return c.callback(a,b);var d=Error(b.statusText||"Unsuccessful HTTP response");d.original=a;d.response=b;d.status=b.status;c.callback(a||d,b)})}function e(a,b){return"function"==typeof b?(new d("GET",a)).end(b):1==arguments.length?new d("GET",a):new d(a,b)}var q=function(){function a(b){if(b){for(var c in a.prototype)b[c]=a.prototype[c];return b}}a.prototype.on=a.prototype.addEventListener=function(a,c){this._callbacks=
this._callbacks||{};(this._callbacks["$"+a]=this._callbacks["$"+a]||[]).push(c);return this};a.prototype.once=function(a,c){function f(){this.off(a,f);c.apply(this,arguments)}f.fn=c;this.on(a,f);return this};a.prototype.off=a.prototype.removeListener=a.prototype.removeAllListeners=a.prototype.removeEventListener=function(a,c){this._callbacks=this._callbacks||{};if(0==arguments.length)return this._callbacks={},this;var f=this._callbacks["$"+a];if(!f)return this;if(1==arguments.length)return delete this._callbacks["$"+
a],this;for(var e,d=0;d<f.length;d++)if(e=f[d],e===c||e.fn===c){f.splice(d,1);break}return this};a.prototype.emit=function(a){this._callbacks=this._callbacks||{};var c=[].slice.call(arguments,1),f=this._callbacks["$"+a];if(f)for(var f=f.slice(0),e=0,d=f.length;e<d;++e)f[e].apply(this,c);return this};a.prototype.listeners=function(a){this._callbacks=this._callbacks||{};return this._callbacks["$"+a]||[]};a.prototype.hasListeners=function(a){return!!this.listeners(a).length};return a}(),t=function(a,
b,c){for(var f=0,e=a.length,d=3==arguments.length?c:a[f++];f<e;)d=b.call(null,d,a[f],++f,a);return d},l="undefined"==typeof k?this||self:k;e.getXHR=function(){if(!l.XMLHttpRequest||l.location&&"file:"==l.location.protocol&&l.ActiveXObject){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(b){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(c){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}else return new XMLHttpRequest;
return!1};var v="".trim?function(a){return a.trim()}:function(a){return a.replace(/(^\s*|\s*$)/g,"")};e.serializeObject=m;e.parseString=p;e.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};e.serialize={"application/x-www-form-urlencoded":m,"application/json":JSON.stringify};e.parse={"application/x-www-form-urlencoded":p,"application/json":JSON.parse};
g.prototype.get=function(a){return this.header[a.toLowerCase()]};g.prototype.setHeaderProperties=function(a){a=this.header["content-type"]||"";this.type=a.split(/ *; */).shift();a=s(a);for(var b in a)this[b]=a[b]};g.prototype.parseBody=function(a){var b=e.parse[this.type];return b&&a&&(a.length||a instanceof Object)?b(a):null};g.prototype.setStatusProperties=function(a){1223===a&&(a=204);var b=a/100|0;this.status=a;this.statusType=b;this.info=1==b;this.ok=2==b;this.clientError=4==b;this.serverError=
5==b;this.error=4==b||5==b?this.toError():!1;this.accepted=202==a;this.noContent=204==a;this.badRequest=400==a;this.unauthorized=401==a;this.notAcceptable=406==a;this.notFound=404==a;this.forbidden=403==a};g.prototype.toError=function(){var a=this.req,b=a.method,a=a.url,c=Error("cannot "+b+" "+a+" ("+this.status+")");c.status=this.status;c.method=b;c.url=a;return c};e.Response=g;q(d.prototype);d.prototype.use=function(a){a(this);return this};d.prototype.timeout=function(a){this._timeout=a;return this};
d.prototype.clearTimeout=function(){this._timeout=0;clearTimeout(this._timer);return this};d.prototype.abort=function(){if(!this.aborted)return this.aborted=!0,this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this};d.prototype.set=function(a,b){if(a===Object(a)){for(var c in a)this.set(c,a[c]);return this}this._header[a.toLowerCase()]=b;this.header[a]=b;return this};d.prototype.unset=function(a){delete this._header[a.toLowerCase()];delete this.header[a];return this};d.prototype.getHeader=function(a){return this._header[a.toLowerCase()]};
d.prototype.type=function(a){this.set("Content-Type",e.types[a]||a);return this};d.prototype.accept=function(a){this.set("Accept",e.types[a]||a);return this};d.prototype.auth=function(a,b){var c=btoa(a+":"+b);this.set("Authorization","Basic "+c);return this};d.prototype.query=function(a){"string"!=typeof a&&(a=m(a));a&&this._query.push(a);return this};d.prototype.field=function(a,b){this._formData||(this._formData=new l.FormData);this._formData.append(a,b);return this};d.prototype.attach=function(a,
b,c){this._formData||(this._formData=new l.FormData);this._formData.append(a,b,c);return this};d.prototype.send=function(a){var b=a===Object(a),c=this.getHeader("Content-Type");if(b&&this._data===Object(this._data))for(var e in a)this._data[e]=a[e];else"string"==typeof a?(c||this.type("form"),c=this.getHeader("Content-Type"),this._data="application/x-www-form-urlencoded"==c?this._data?this._data+"&"+a:a:(this._data||"")+a):this._data=a;if(!b||n(a))return this;c||this.type("json");return this};d.prototype.callback=
function(a,b){var c=this._callback;this.clearTimeout();c(a,b)};d.prototype.crossDomainError=function(){var a=Error("Origin is not allowed by Access-Control-Allow-Origin");a.crossDomain=!0;this.callback(a)};d.prototype.timeoutError=function(){var a=this._timeout,b=Error("timeout of "+a+"ms exceeded");b.timeout=a;this.callback(b)};d.prototype.withCredentials=function(){this._withCredentials=!0;return this};d.prototype.end=function(a){var b=this,c=this.xhr=e.getXHR(),d=this._query.join("&"),h=this._timeout,
g=this._formData||this._data;this._callback=a||r;c.onreadystatechange=function(){if(4==c.readyState){var a;try{a=c.status}catch(d){a=0}if(0==a)return b.timedout?b.timeoutError():b.aborted?void 0:b.crossDomainError();b.emit("end")}};a=function(a){0<a.total&&(a.percent=100*(a.loaded/a.total));b.emit("progress",a)};this.hasListeners("progress")&&(c.onprogress=a);try{c.upload&&this.hasListeners("progress")&&(c.upload.onprogress=a)}catch(l){}h&&!this._timer&&(this._timer=setTimeout(function(){b.timedout=
!0;b.abort()},h));d&&(d=e.serializeObject(d),this.url+=~this.url.indexOf("?")?"&"+d:"?"+d);c.open(this.method,this.url,!0);this._withCredentials&&(c.withCredentials=!0);"GET"==this.method||("HEAD"==this.method||"string"==typeof g||n(g))||(d=e.serialize[this.getHeader("Content-Type")])&&(g=d(g));for(var k in this.header)null!=this.header[k]&&c.setRequestHeader(k,this.header[k]);this.emit("request",this);c.send(g);return this};e.Request=d;e.get=function(a,b,c){a=e("GET",a);"function"==typeof b&&(c=
b,b=null);b&&a.query(b);c&&a.end(c);return a};e.head=function(a,b,c){a=e("HEAD",a);"function"==typeof b&&(c=b,b=null);b&&a.send(b);c&&a.end(c);return a};e.del=function(a,b){var c=e("DELETE",a);b&&c.end(b);return c};e.patch=function(a,b,c){a=e("PATCH",a);"function"==typeof b&&(c=b,b=null);b&&a.send(b);c&&a.end(c);return a};e.post=function(a,b,c){a=e("POST",a);"function"==typeof b&&(c=b,b=null);b&&a.send(b);c&&a.end(c);return a};e.put=function(a,b,c){a=e("PUT",a);"function"==typeof b&&(c=b,b=null);
b&&a.send(b);c&&a.end(c);return a};"object"===typeof module?module.exports=e:k.request=e})(window);
